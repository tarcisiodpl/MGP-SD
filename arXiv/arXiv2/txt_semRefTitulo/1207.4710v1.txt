
The Canadian traveler problem (CTP) is the problem of traversing a
given graph, where some of the edges may be blocked – a state which is
revealed only upon reaching an incident vertex. Originally stated by Papadimitriou and Yannakakis (1991), the adversarial version of CTP was
shown to be PSPACE-complete, with the stochastic version shown to be
#P-hard.
We show that stochastic CTP is also PSPACE-complete: initially proving PSPACE-hardness for the dependent version of stochastic CTP, and
proceeding with gadgets that allow us to extend the proof to the independent case.
Since for disjoint-path graphs, CTP can be solved in polynomial time,
we examine the complexity of the more general remote-sensing CTP, and
show that it is NP-hard even for disjoint-path graphs.
Keywords: Canadian Traveler Problem, Complexity of Navigation under
Uncertainty, Stochastic Shortest Path with Recourse

1. Introduction
In the stochastic Canadian traveler problem (CTP) [1] we are given an
undirected connected weighted graph G = (V, E), a source vertex (s ∈ V ),
and a target vertex (t ∈ V ). Any edge e ∈ E may be blocked with a known
∗

Corresponding author
Email addresses: friedd@cs.bgu.ac.il (Dror Fried), shimony@cs.bgu.ac.il
(Solomon Eyal Shimony), amitbenb@cs.bgu.ac.il (Amit Benbassat),
cenny@cwenner.net (Cenny Wenner)
July 20, 2012

probability p(e). The actual state of each edge e ∈ E becomes known only
upon reaching a vertex incident on e. Traversing an unblocked edge e incurs
a non-negative cost equal to the weight of e. The problem is to find a policy
π that minimizes the expected traversal cost C(π) from s to t.
CTP formalizes a basic question of navigating in a partially known environment, which is a fundamental task for transportation, autonomous
robotic systems, computer games, and more. Other variants of CTP have
been introduced and analyzed in the research literature [2, 3, 4]. There
has been a strong recent resurgence of interest in CTP, both theoretical
[5, 6] and empirical [7, 8, 9]. A preliminary alternative proof of Theorem 2
appears in an unpublished work by one of the authors [10].
When originally introduced in [1], two variants were examined: the adversarial variant and the stochastic variant. The adversarial variant was
shown to be PSPACE-complete by reduction from QSAT. For the stochastic
version, membership in PSPACE was shown, however only #P-hardness was
established by reduction from the st-reliability problem, leaving the question
of PSPACE-hardness open. Apparently proving the stronger result requires
some form of dependency between the edges, achieved “through the back
door” in the adversarial variant. This paper settles the question, showing
that CTP is indeed PSPACE-complete.
Since the size of an optimal policy is potentially exponential in the size
of the problem description, we in fact show that it is PSPACE-hard to find
even the optimal first action at s.
We begin with a variant of CTP with dependent directed edges, CTPDep, which allows for a simple proof of PSPACE-hardness by reduction from
QSAT, before proceeding with the proof for the “standard” stochastic CTP.
Although the latter result subsumes the former, proving the dependent CTP
result first greatly simplifies the intuition behind the proof of the standard
case.
Another variant we explore is remote-sensing CTP, henceforth called
Sensing-CTP, in which additional actions called remote-sensing actions are
allowed. Each such action reveals, for a certain cost, the status of a nonincident edge. Recently it was shown [9] that stochastic CTP can be solved
in low-order polynomial time on disjoint-path graphs. It was believed that
generalizing CTP to allow remote-sensing actions makes the problem harder
– indeed we show that allowing remote-sensing makes CTP NP-hard even
on disjoint-path graphs.
2

2. Dependent directed CTP is PSPACE-hard
This general form of dependent CTP (called CTP-Dep) is a 5-tuple
(G, w, s, t, B) with G = (V, E) a directed graph, a weight function w : E →
<≥0 , s, t ∈ V are the start and goal vertices respectively, and a distribution
model B over binary random variables indexed by the edges E. We assume
that B is specified as a Bayes network over these random variables E [11]
as follows. Each random variable expresses the state (blocked, unblocked)
of an edge in E (abusing notation we use the symbols indicating the edges
to denote the respective random variables). The Bayes network (E, A, P )
consists of a set of directed arcs A between the random variables E, so that
(E, A) is a directed acyclic graph. P describes the conditional probability
tables, one for each e ∈ E.
Theorem 1. CTP-Dep is PSPACE-hard.
Proof. by reduction from QSAT [12]. Recall that QSAT is the language of
all satisfiable quantified boolean formulas (QBF), Φ = ∀x1 ∃x2 ...ϕ(x1 , x2 , ..., xn ),
where ϕ is a boolean formula in conjunctive normal form, with n variables
and m clauses, which contain literals, each is consisting of either a variable
or a negated variable. We assume that each clause has at most 3 literals.
Given a QBF Φ, construct a CTP-Dep instance (GΦ , w, s, t, B) as follows
(see Fig. 1). GΦ consists of a variables section, and an exam section. Vertices in the variables section have labels starting with v or o, and vertices of
the exam section begin with r. An always unblocked edge (s, t), called the
default edge, has a cost of h. All other edges, unless mentioned otherwise,
are zero-cost edges known to be unblocked.
The variables section contains a subsection Xi for every variable xi ,
which begins at vi , and ends at vi0 . For every i < n, Xi is connected to Xi+1
through an edge (vi0 , vi+1 ).
Every Xi contains a true-path (vi , vi1 , · · · , vim , vi0 ), and a false-path (vi , v̄i1 , · · · , v̄im , vi0 ).
If xi is a universal variable (resp. existential variable), the edges (vi , vi1 ),
and (vi , v̄i1 ) are called universal edges (resp. existential edges). While the
existential edges are always unblocked, we set the universal edges to have
have blocking probability 1/2 and to be mutually exclusive: for each universal variable xi , exactly one of (vi , vi1 ), and (vi , v̄i1 ) is blocked.
In addition, for every 1 ≤ i ≤ n, and 1 ≤ l ≤ m, there are edges (oil , vil ),
and (ōil , v̄il ), called observation edges. These edges are only meant to be
observed, as their source vertices are unreachable. Every observation edge
3

∀x1

o11 o12
s

v11
v1
v̄11

h

o1m

∃x2
o21 o22

v21
v1m v10 v2

v22

v2m v20

v̄12

v̄1m

v̄22

v̄2m

ō11 ō12

ō1m

ō21 ō22

on1 on2

o2m

v12

v̄21

∃xn

vn1
vn
v̄n1

vn2

vnm

v̄n2

v̄nm

ōn1 ōn2

ō2m

variables section
t

t

onm

ōnm
r1

r10
1
r20

1

r0
r2

exam section
Figure 1: Reduction from QBF to CTP-Dep. Note that vertex t appears twice in order
to simplify the physical layout.

is blocked with probability 1/2, and the dependency of the observation edges
is defined according to appearance of variables in the clauses of Φ, as follows:
an observation edge (oil , vil ) (resp. (ōil , v̄il )) is considered “in” a clause Cl
if xi appears unnegated (resp. negated) in clause Cl . All observation edges
that are “in” the same clause Cl co-occur: they are either all traversable or
all are blocked (with probability 1/2, as stated above), independent of all
other edges that are not “in” Cl .
The exam section consists of an odd-path (r0 , r1 , r10 , t), and an even-path
(r0 , r2 , r20 , t). In addition construct edges (r1 , t), and (r2 , t) with cost 1. The
edges (r1 , r10 ), and (r2 , r20 ) are called choice edges. The edge (r1 , r10 ) (resp.
(r2 , r20 )) is unblocked if and only if the observation edges are unblocked for
an odd (resp. even) number of clauses. Hence exactly one of the choice edges
is blocked 1 . If at least one observation edge in each clause is observed, the
status of the choice edges can be determined with certainty. Otherwise the
posterior blocking probability of each choice edge remains 1/2. In order to
prove the theorem, it is sufficient to prove the following claim:
Claim 1. An optimal policy has expected cost 0 just when Φ is satisfiable
1

Note that as every clause has at most three literals, this dependency structure can be
realized with a Bayes network of constant in-degree, a construction that has polynomial
size.

4

vn0

(in which case the optimal first action is to traverse (s, v1 )). Otherwise (for
n
any h < 2− 2 −1 ) the optimal policy is to traverse (s, t) with a cost of h.
Proof. Suppose first that Φ is satisfiable. Then there is a policy for assigning values to all the existential variables, each given every setting of the
enclosing universal variables, such that ϕ is true. Following this policy for
each existential variable xi , i.e. traversing edge (vi , vi1 ) if xi should be true,
and (vi , v̄i1 ) otherwise, leads (by construction) to following a path such that
at least one observation edge is seen in every clause. Hence, the “exam” is
passed (i.e. the 0-cost unblocked path in the exam section is chosen) with
certainty.
Next, suppose Φ is not satisfiable. Then there is at least one setting
of the universal variables for which some clause Cl is false under the same
conditions, and thus no edge “in” clause C is observed. Since every setting
n
of these variables occurs with probability 2− 2 (assuming w.l.o.g. that n is
even), in these cases the exam is “flunked” (picking the path where only
the expensive edge is unblocked) with probability 1/2, and thus the total
n
expected cost of starting with (s, v1 ) is at least 2− 2 −1 . Hence, setting h <
n
2− 2 −1 , the optimal policy is to traverse (s, t) if and only if Φ is not satisfiable.

3. Complexity of CTP
Having shown that CTP-Dep is PSPACE-hard, we extend the proof to
the “standard” stochastic independent undirected edges CTP:
Theorem 2. CTP is PSPACE-complete.
In order to prove Theorem 2, we use the same general outline of the
reduction from QBF as in the proof of Theorem 1. However, in CTPDep, dependencies and directed edges restrict the available choices, thereby
simplifying the proof. Here we introduce special gadgets that limit choice de
facto, and show that any deviation from these limitations is necessarily suboptimal. Policies that obey these limitation are called reasonable policies.
Each such gadget g has an entry terminal Entry(g), and an exit terminal
Exit(g); an attempt to traverse g from Entry(g) to Exit(g) is henceforth
called to cross g. The gadgets operate by allowing a potential shortcut to
the target t; crossing these gadgets may either end up at Exit(g), with some
probability q(g), or at t instead. The edges that allow direct access to t are
called shortcut edges.
5

We introduce the gadgets in sections 3.1 and 3.2, and the CTP-graph
construction in Section 3.3. The actual proof of Theorem 2 is in Section
3.4. In the description of the gadgets and CTP-graph, we sometimes add
zero cost always traversable edges. These edges, which appear unlabeled in
figures 2,3 and 4, were added solely in order to simplify the physical layout
as a figure; any u, v connected by such an edge can be considered to be the
same vertex.
3.1. Baiting Gadgets
A baiting gadget g = BG(u, v) with parameter L > 1 is a three-terminal
weighted graph (see Fig. 2): an entry terminal u = Entry(g), an exit
terminal v = Exit(g), and a shortcut terminal which is always t. The latter
terminal is henceforth omitted in external reference to g, for conciseness.
The baiting gadget consists of N + 1 uniform sections of an undirected
path (u, v1 , · · · , vN , v) with total weight L, each intermediate vertex has a
0-cost shortcut to t with a blocking probability 1/2. In addition, there is a
shortcut edge with cost L from the terminals u, v to t. Set N = 2dlog2 (4L)e −1.
We assume that g is connected to the graph such that any policy executed
at u, in which the edge (u, v1 ) is not traversed, has an expected cost of
at least 1. Later on we see that this assumption holds in the CTP-graph
construction.
Let π be the following partial policy: when at u for the first time, proceed
along the path (u, v1 , · · · , vN , v) to v, taking the 0-cost shortcut to t whenever
possible, but never backtracking to u.
It is easy to show that even if we need to take the cost L shortcut at v,
the expected cost of executing π at u for the first time is less than 1. Because
of the L cost shortcut edge (v, t), the expected cost of any optimal policy
once at v (knowing all 0-cost shortcuts are blocked) is no more than L, hence
under any reasonable policy, g is not retraced. A similar argument holds for
retracing to u from other locations along the path (u, v1 , · · · , vN , v). Hence
we have:
Claim 2. When at u for the first time, π is optimal for a baiting gadget
BG(u, v) with a parameter L > 1. After reaching v, it is suboptimal to
backtrack to u in g.
Note that g is actually symmetric w.r.t. u, v. However, since by construction of the CTP-graph, every reasonable policy always reaches one
designated terminal u first, we treat g externally as if it were directional. A
6

t

L
u

L
N +1

0| 12
v1

L
N +1

v2

0| 12

0| 12

L

vN

L
N +1

v

Figure 2: A Baiting Gadget BG(u, v) with a parameter L > 1. Edge label w|p denotes
cost|blocking probability. The optimal policy at u is to cross the path (u, v1 , · · · , vN , v),
taking a shortcut edge to t whenever such an edge is found unblocked. After reaching v,
retracing to u in g costs at least L.

precise derivation of the parameters of baiting gadgets appears in Appendix
A.1.
3.2. Observation Gadgets
An observation gadget g = OG(u, v, o) is a four-terminal weighted graph
(see Fig. 3): an entry terminal u = Entry(g), an exit terminal v = Exit(g),
an observation terminal o, and a shortcut terminal (again omitted in external references) which is always t. The observation gadget begins with a baiting gadget BG1 = BG(u, v1 ) with parameter L > 8, which is connected to
the “observation loop” beginning with a baiting gadget BG2 = BG(v1 , v2 )
with parameter 3L/2, a zero-cost edge (v2 , v3 ) with blocking probability
3/4, and a cost L1 = 5L/8 unblocked edge to o. An always unblocked 3L/2
shortcut edge (v2 , t) is assumed. The observation loop is closed by a cost L1
unblocked edge to v4 and a zero-cost edge (v4 , v1 ) with blocking probability
3/4. From v1 , a cost 1 unblocked edge (v1 , v 0 ) followed by a baiting gadget
BG3 = BG(v10 , u) with parameter L completes the gadget.
We assume that o is either not directly connected to the rest of the
graph, or connected through a path (r2 , r3 , r4 , r5 , r10 , r20 ) called the exam
section path (o is identified with r5 ) with the following properties: the
edges (r2 , r3 ), (r10 , r20 ) and (r4 , r5 ), have zero cost and blocking probability
p1 , where p1 > 1 − 2/(3L + 1). (r2 , r3 ) and (r10 , r20 ) are called guard edges,
(r4 , r5 ) is called an observation edge. The edges (r3 , r4 ) and (r5 , r10 ) are
always traversable edges with cost 1. The vertex o is allowed to coincide
with observation terminals of other observation gadgets. The notations of
7

u

v1

BG1

t

BG2

3L
2

v10

1

BG3

v

0| 34

v2

v4

0| 34
v3

L1

L1
o
r2

r3
0|p1

1

r10

r5

r4
0|p1

1

r20
0|p1

the exam section path

Figure 3: An Observation Gadget OG(u, v, o). Light gray arrows indicate general traversal direction of the optimal policy π.

the exam section path are chosen to match the description of the CTP-graph
construction in Section 3.3.
Let πg be the following partial policy at g: when at u, cross BG1 . Then
(observing (v1 , v4 )), cross BG2 . If either (v2 , v3 ), or (v1 , v4 ) is found blocked,
reach t by traversing the cost 3L/2 shortcut edge (v2 , t). However, if both
(v2 , v3 ) and (v1 , v4 ) are unblocked, traverse (v2 , v3 , o, v4 , v1 , v10 ) (observing
any edges incident on o such as the observation edge (r4 , r5 )), and cross
BG3 .
Again, by construction of the CTP-graph (section 3.3), any policy at u
other than crossing BG1 results in a cost of at least 1.
Claim 3. When at u for the first time, πg is an optimal policy for g.
Proof Outline. Properties of the baiting gadgets ensure that g is traversed in the correct order. The guard edges (r2 , r3 ) and (r10 , r20 ) ensure that
it is suboptimal to “escape” from o by traversing edges in the exam section.
The uncertain edges (v4 , v1 ) and (v2 , v3 ) ensure that it is suboptimal to enter
a previously uncrossed observation gadget from o. Likewise for a previously
crossed observation gadget g 0 : entering g 0 through o is suboptimal because
8

all the baiting gadgets in g 0 have been crossed and observed to contain no
unblocked zero-cost shortcuts.
Detailed derivation of the properties of observation gadgets appears in
Appendix A.2.
3.3. CTP-graph Construction

o11
v11
1| 12

o1m

0
v12
v1m

OG

false-path
0
v̄1m
v̄12

1| 12

v̄11 OG OG
ō11 ō12

t

∃x2

o2m
0
0
v
v
OG OG 22 2mOG v2m
1
1
true-path
o21

o22

v21

v10 BG v2

v00

h

0
v1m

1

true-path

BG v1

1

s

o12

OG OG

variables section

∀x1

1

OG v̄0
1m
ō1m

1

false-path
0 v̄
2m
v̄22

OG
v̄21 OG
ō21
ō22

v20

vn0

1

OG v̄0
2m
ō2m

t
L
1
r0

0|p1 0|p1

r1
1

r1
2

0|p1 1
1 0|p1
0|p1 1
1 0|p1
e
2 r2
2 e2 r 2 r 3
r1 r1 1 r1 r2
r
r
3 4
5
2
1
3
4
5
1

1
rm
3

0|p1

1 0|p1 0|p1
em m
m+1
r
r
5
2

1

t
r

m+1
4

exam section
z0

BG

z1

BG

z2

guards section

zm+1

BG

zm+2

Figure 4: CTP-graph construction for Φ = ∀x1 ∃x2 · · · (x̄1 ∨ x̄2 ) ∧ (x̄1 ∨ x2 ) · · · . BG a baiting gadget. OG - an observation gadget. Light gray arrows indicate the general
traversal direction of the optimal policy when Φ is satisfiable.

Having shown the properties of the baiting and observation gadgets, we
are ready to construct the CTP-graph: For a QBF Φ with n variables and m
clauses, we construct GΦ in the same general outline as the construction of
the CTP-Dep graph (see section 2) with the following changes (see Fig. 4).
The exam section is a path of 5(m+1)+1 vertices {rji |1 ≤ i ≤ m+1, 1 ≤ j ≤
5} as follows. For every 0 < i ≤ m+1, (r1i , r2i ), (r2i , r3i ) and (r4i , r5i ) have zero
cost and blocking probability p1 , apart from (r4m+1 , r5m+1 ) which has zero cost
and is always traversable. (r1i , r2i ), and (r2i , r3i ) are called guard edges, and
9

(r4i , r5i ) is called a clause edge. (r3i , r4i ) and (r5i , r1i+1 ) are always traversable
cost 1 edges. In addition, the exam section holds an additional vertex r0 ,
an always traversable cost 1 edge (r0 , r11 ), and an always traversable cost
L edge (r0 , t). In order to guarantee correct operation of the observation
gadgets, we disallow reasonable policies to traverse exam edges too early
while crossing the variable section. This is done by visiting the initially
uncertain guard edges only later via a section called the guards section,
which consists of a sequence of baiting gadgets BG(zi , zi+1 ) with parameter
L that visit r2i for all 0 ≤ i ≤ m + 1.
The variables section is constructed as for CTP-Dep, except that the
directed edges (vi0 , vi+1 ) are replaced by baiting gadgets BG(vi0 , vi+1 ) with
parameter L. For each universal variable xi the universal edges (vi , vi1 ), and
(vi , v̄i1 ) are cost 1 edges with blocking probability 1/2. For each existential
variable xi , the existential edges (vi , vi1 ), and (vi , v̄i1 ) are always traversable
edges with cost 1. Inside each true-path, every (vij , oij ), (vij , vi(j+1) ) pair
is replaced by an observation gadget g = OG(vij , vij0 , oij ). (vij0 , vi(j+1) ) are
always unblocked zero-cost edges added for clarity. The observation vertex
oij is identified with the vertex incident on the appropriate clause edge in
the exam section. That is, if xi appears unnegated in clause j, then oij of
the true-path is identified with r5j in the exam section. Likewise respectively
for all the edges in the false-paths.
For example, Fig. 4 demonstrates the reduction for Φ = ∀x1 ∃x2 · · · (x̄1 ∨
x̄2 ) ∧ (x̄1 ∨ x2 ) · · · . The variable x1 appears negated in clause 2, so in GΦ
the vertex ō12 at the section X1 , and the vertex r52 of the exam section are
connected by an unlabeled edge, hence the clause edge e2 = (r42 , r52 ) can be
0
observed from the observation gadget OG(v̄12 , v̄12
, ō12 ) when traversing the
false path of X1 . Likewise, the connection of other observation gadgets can
be explained similarly.
3.4. Proof of Theorem 2
Given a QBF Φ with n variables and m clauses, we construct GΦ as in
3L+1
Section 3.3. Set L = 8m + 16 and p1 = 1 − 2−dlog2 ( 2 )e . We show that it
is optimal to traverse (s, v0 ) if and only if Φ is satisfiable.
Unless stated otherwise, we henceforth consider only reasonable policies
for GΦ that do not begin with the default action of traversing (s, t). Due to
properties of the gadgets (claims 2, 3) any reasonable policy π for GΦ must
follow the restrictions in Table 1, as any other action is suboptimal.
Most of these restrictions are immediate consequences of executing optimal policies at the baiting and observation gadgets (see Appendix A.1 and
10

Table 1: Reasonable policy actions in π

Location
vi0 , for i < n
vi , for i ≤ n,
vil , for i ≤ n,
v̄il for i ≤ n,
zl , for 0 < l ≤ m + 2
r0

Action
cross BG(vi0 , v1+1 )
go to vi1 or v̄i1
cross OG(vil , vil0 , oil )
cross OG(v̄il , v̄il0 , ōil )
cross BG(zl , zl−1 )
pass exam or take shortcut

Appendix A.2 for detail). The following claim, proved in Appendix B.1,
shows the actions of any reasonable policy for GΦ at r0 .
Claim 4. At r0 , any reasonable policy acts as follows:
• If all the edges in the exam section were observed to be unblocked,
cross (r0 , r11 , · · · , r4m+1 , t) until reaching t for a cost of 2(m + 1).
• Otherwise, cross the cost L shortcut edge (r0 , t).
Therefore, reasonable policies for GΦ differ only in the choices made in
the universal and existential edges, and in the choice at r0 which is either
to traverse the exam section if all clause edges were observed, or otherwise
take the expensive shortcut (r0 , t).
Now let π be a reasonable policy for GΦ , and denote the expected cost of
π by C(π). Define a weather to be an assignment of {traversable, blocked}
to the edges of GΦ . Let W be the set of all possible weathers for GΦ , and
for w ∈ W let pw be the probability that weather w occurs. Define C(π, w)
to be the cost of executing π over a weather w. Then
X
C(π) =
pw C(π, w)
(1)
w∈W

Next, partition W into full-trip weathers W f (π), in which r0 is reached
while executing π; and shortcut weathers W s (π) in which r0 is not reached
due to taking a shortcut edge to t before reaching r0 . Then:
X
X
C(π) =
pw C(π, w) +
pw C(π, w)
(2)
w∈W s (π)

w∈W f (π)

11

Let π T be a policy for GΦ such that in every subsection Xi of the variables
section, whenever possible, the true-path is always chosen. Define:
X
Dst =
pw C(π T , w)
(3)
w∈W s (π T )

As all the true-paths, and false-paths of all the variables section are symmetric in the number of observation gadgets and other edges, there is a bijection
gπ : W s (π) → W s (π T ) such that pw = pgπ (w) and C(π, w) = C(π T , gπ (w))
for every w ∈ W s (π). Hence we have:
X
Dst =
pw C(π, w)
w∈W s (π)

and
C(π) = Dst +

X

pw C(π, w)

(4)

w∈W f (π)

Again, due to symmetry, and the properties of the baiting and observation
gadgets (claims 2, 3), the total cost from s to r0 while executing π in any
weather w ∈ W f (π) is independent of w. We denote this cost by Dpt ,
and can compute it simply by summing the cost of traversing from s to r0
through the variable section and guard section, assuming that r0 is reached.
Then we get:
19mL + 4
)n + (n + m + 1)L
(5)
4
Then from r0 to t the cost is either 2(m + 1) (if the exam section is known
to be completely unblocked), or L > 2(m + 1) (taking the shortcut (r0 , t),
if some edges in the exam section are known to be blocked, or some such
unknown edges remain). Hence for any full-trip weather w, C(π, w) is either
Dpt + L, or Dpt + 2(m + 1).
Let PΦπ ∈ [0, 1] be the probability that not all the clause edges of the
exam section were observed in a full-trip weather by following π (this probability depends on the formula Φ). Then, with probability (1 − PΦπ )(1 −
p1 )3m+2 all the edges of the exam section were observed and were found
unblocked before reaching r0 . Let Prt = (1 − p1 )3m+2 be the probability
that all the edges in the exam section are unblocked and denote by Pr0 the
probability of reaching r0 by executing π. Again, due to symmetry of the
baiting and observation gadgets, Pr0 is independent of π. We get:
12
Dpt = 1 + (2 +

X

pw C(π, w) = Pr0 (Dpt +PΦπ L+(1−PΦπ )(Prt 2(m+1)+(1−Prt )L) (6)

w∈W f (π)

And therefore
C(π) = Dst + Pr0 (Dpt + PΦπ L + (1 − PΦπ )(Prt 2(m + 1) + (1 − Prt )L)) (7)
If Φ is satisfiable, then, as in the proof of Theorem 1, there is a reasonable
policy π which follows the assignments that satisfy Φ, thus every clause edge
is observed, and PΦπ = 0. Define B0 = C(π) for such a policy π when Φ is
satisfiable. Then
B0 = Dst + Pr0 (Dpt + Prt 2(m + 1) + (1 − Prt )L)

(8)

If Φ is not satisfiable, then at some universal subsection Xi of the variables section, there is a probability of at least 1/4 that a universal edge
must be traversed, such that upon reaching r0 , not all the clause edges are
n
visited. Hence, in total, there is a probability of at least ( 41 ) 2 that not all
the clause edges are visited. Note that as Pr0 already excludes events where
both universal edges are blocked for some variable, if Φ is not satisfiable,
n
then for every reasonable policy π, PΦπ > ( 31 ) 2 . Hence define B1 as follows.
1 n
1 n
B1 = Dst + Pr0 (Dpt + ( ) 2 L + (1 − ( ) 2 )(Prt 2(m + 1) + (1 − Prt )L)) (9)
3
3
Then B1 > B0 , and if Φ is not satisfiable, then C(π) ≥ B1 . Now let
n
h = w((s, t)) = B0 + ( 41 ) 2 mPr0 , so that B1 > h > B0 . Thus the optimal
action at s is to traverse (s, t) if and only if Φ is unsatisfiable. Since the
CTP-graph construction used a polynomial number of vertices, and all the
weights and probabilities by construction need only a polynomial number
of bits (see Appendix B.2 for the technical computation of h), Theorem 2
follows.

Several corollaries follow due to the construction of GΦ :
Corollary 1. It is PSPACE-hard to determine the expected cost of the optimal policy in CTP.
By replacing all the edges with appropriately directed edges, we get:
13

Corollary 2. CTP with directed edges but no dependencies is PSPACEcomplete.
Finally, as every unknown edge in this construction of GΦ has cost 0
and a probability which is a power of 2 of being unblocked (the universal
edges, for example, can be split into a two-edge path), we can replace every
unknown edge with a path of zero-cost, blocking probability 1/2 edges and
get:
Corollary 3. CTP remains PSPACE-complete even if all the unknown
edges have zero cost and blocking probability 1/2.
4. Complexity of CTP with remote sensing
A somewhat more general version of CTP is Sensing-CTP. In this variant, the state of graph edges can be remotely sensed at any time, paying
a known cost. Formally, Sensing-CTP is defined exactly the same way as
stochastic CTP, w.r.t. the graph, edge-blocking probabilities and weights,
and source and target vertices (see Section 1). In addition, a sensing cost
function SC : V × E → <+ is given. An edge e, not necessarily incident
on a vertex v, can be sensed for a cost SC(v, e) and as a result, the true
state of e is revealed. The problem in Sensing-CTP is to find a policy which
minimizes the total expected sensing cost plus travel cost from s to t.
CTP is solvable in polynomial time when the graph consists of edgedisjoint paths which meet only at s and t [9]. This gives rise to the question
whether Sensing-CTP is also tractable for disjoint paths. We show that this
is not the case for Sensing-CTP unless P=NP. Again, since the size of the
policy may be exponential in the size of the graph, we actually show that
it is NP-hard to determine even the first action in an optimal policy.
Theorem 3. Sensing-CTP is NP-hard even in disjoint-path graphs.
Proof. By reduction from the NP-complete problem vertex cover (VC)
[12]. Let G = (V, E) be an undirected graph, for which we need to decide
if there is an S ⊆ V of size at most k such that every edge in E is incident
on a vertex in S (S is called a vertex cover of size k). The idea of the proof
is, informally, for a policy to benefit if it ’has sensed’ all of the edges in a
given VC instance, where sensing of all neighbors of a vertex can be done at
some constant cost. By tweaking constants, these actions will be beneficial
14

if and only if it is possible to sense all edges in the VC instance by sensing
the neighbors of at most k vertices.
Construct the corresponding CTP-PATH graph G0 = (V 0 , E 0 ) as follows
(see Fig. 5). For each vertex v ∈ V , construct a “vertex” node f (v) ∈ V 0 ,
an edge (s, f (v)) with a cost C defined below, and an infinite-cost edge
(f (v), t). Also construct the “default edge” (s, t) with cost 4. The above
edges are always traversable.
Construct the “sensing path”, a path consisting of a
“leader” always traversable edge e0 with cost L starting at s, and for
each edge e ∈ E, a zero-cost edge f (e) in sequence, and finally an infinitecost edge (u, t). The probability that each of the latter edges is blocked
is , a small positive number defined below, except for (u, t) which has
infinite-cost, therefore is never traversable. Additionally, we have a two
edge “uncertain” path ((s, x), (x, t)) where (s, x) is always traversable and
costs 2, and (x, t) is traversable with probability 1/2 and costs 0. Note that
the resulting graph G0 consists only of edge-disjoint paths leading from s to
t.

f (v1 )
C

f (v|V | )

C
s

∞
∞

0|
L
e0 f (e1 )

0| sensing path 0|
∞
u
f (e|E| )
f (e2 )

t

0| 12

2
”uncertain” path

x
4
Figure 5: CTP-graph for reduction from vertex cover

The sensing cost from “vertex” node f (v) on edge f (e) is 0 for all e
incident on v in G. Sensing (x, t) costs 0 from u. All other sensing costs
15

are infinite. We show that for parameter values defined below, the optimal
policy is to immediately traverse (s, t) if and only if G does not have a
vertex cover of size k.
Assuming no sensing, there are only two “reasonable” traversal policies:
traversing (s, t) immediately for a cost of 4, or trying the uncertain path,
which costs 2 if (x, t) is traversable, and 8 if not, for an expected cost of
5. Thus the optimal policy with no sensing is to traverse (s, t). However, if
sensing is allowed, the “value of information” of knowing whether (x, t) is
traversable is: V OI(x, t) = 4 − (2 × 1/2 + 4 × 1/2) = 1, due to the fact that
if (x, t) is revealed as traversable (which happens with probability 1/2) we
gain 2 by taking the ”‘uncertain”’ path instead of (s, t), and otherwise gain
nothing.
We show below that for appropriate values of L, it is not beneficial to
try to get to u in order to sense (x, t) unless sensing reveals that the path
to u is unblocked. The probability that at least one edge on the sensing
path is blocked is at least . However, all the edges in the sensing path can
be sensed (stopping if any blocked edge is sensed) for a cost Csense defined
below. If G has a vertex cover of size k, then Csense ≤ 2Ck by visiting k
“vertex” nodes. However, if the smallest vertex cover is of size k 0 ≥ k + 1,
the expected sensing cost becomes:
0

Csense

k Y
i−1
X
= 2C
(1 − )dj ≥ 2Ck 0 (1 − )|E|

(10)

i=1 j=1

where dj is the number of previously unsensed edges of the jth vertex in
the (unknown) optimal sensing order. For any 0 < α < 1, set  such that
=1−(

1
k + 1 − α |E|
)
k+1

Then, as 2Ck 0 (1 − )|E| ≥ 2C(k + 1 − α), we have that

Now set L =

1
2

−


4

Csense ≥ 2C(k + 1 − α)
and:
C=

(1 − )|E|
2(2k + 1 − α)

To complete the proof, it is sufficient to prove the following claim:
16

Claim 5. The optimal action at s is to traverse (s, t) if and only if G does
not have a vertex cover of size k.
Proof. We show the following:
• If there is no cover in size k, the optimal policy is to traverse (s,t).
• Otherwise, the optimal policy is as follows: visit the “vertex” nodes
constituting the cover, doing the appropriate sensing actions; if the
sensing path is unblocked, visit u in order to sense (x, t), and then
take the path from s to t through x if (x, t) is found traversable. (In
this case, given the optimal policy, one can straightforwardly construct
the vertex cover of size k.)
Note that it is suboptimal to try the sensing path unless assured that all
edges leading to u are traversable, because then there is at least one edge
that can be blocked with probability , in which case attempting this path
results in no positive gain. To see this, note that the traversal cost 2L must
be paid anyway, thus the total expected gain from trying the sensing path
is:

1 
g ≤ (1 − )V OI(x, t) − 2L = 1 −  − 2L = 1 −  − 2( − ) = − < 0
2 4
2
This also holds for all policies that attempt some sensing actions before
trying the sensing path, but that do not make sure that u is reachable before
trying the sensing path.
Now, if there is a vertex cover of size k, the expected cost of sensing
all edges in the sensing path is at most 2Ck. If u is found to be reachable
(prior probability (1 − )|E| of that happening) use the sensing path (which
costs 2L) to sense (x, t), gaining the expected V OI(x, t) of 1. The total
expected gain in this case is positive:

(1 − )|E|
g ≥ (1−) (V OI(x, t)−2L)−2Ck = (1−) (1−(1− ))−2k
2
2(2k + 1 − α)
0

|E|

|E|

1
2k
= (1 − )|E| ( −
)>0
2 2(2k + 1 − α)

Finally, if there is no vertex cover of size k, then the expected gain for
sensing in the best case is (assuming the policy of sensing all edges in the
17

sensing path from only k + 1 “vertex” nodes, costing at least 2C(k + 1 − α)
in expectation) is at most:
g 00 ≤ (1 − )|E| (V OI(x, t) − 2L) − 2C(k + 1 − α) =
(1 − )|E|

(1 − )|E| (1 − (1 − )) − 2(k + 1 − α)
2
2(2k + 1 − α)
1
2(k + 1 − α)
= (1 − )|E| ( −
)<0
2 2(2k + 1 − α)

and thus the optimal policy here is not to perform sensing at all, but to
traverse (s, t) immediately.

5. Discussion
Having shown that stochastic CTP is PSPACE-hard, several related
questions on variants of CTP and CTP with restricted topologies arise. One
issue of particular interest is the question of efficiently finding approximately
optimal actions. The proofs in this paper make use of rather small gaps
between expected values of two candidate actions, and thus leave open the
possibility of efficient approximation algorithms.
Studies of the competitive analysis of the Canadian Traveler Problem
reveal rudimentary bounds on approximability. Denoting by k the number of uncertain edges in an instance, there exists for the undirected case
polynomial-time algorithms achieving competitive ratios of 2k + 1 [6]. As a
consequence, stochastic CTP can be approximated within 2k + 1. With a
slightly improved analysis, the same algorithm yields a 2n+1-approximation.
In the directed case, existing results from competitive analysis only yield
approximations of 2k+1 + 1 and 2n+1 + 1, respectively [5].
These approximation algorithms forego entirely the stochastic nature of
the problem and leave open considerable improvements. At the time of this
writing, no notable hardness of approximation results are known.
Another issue is: what is the most general graph topology under which
CTP is tractable or easy to approximate? An efficient algorithm was shown
[9] for disjoint-path graphs, based on a lemma that there exists an optimal
policy that is committing: (such a policy never returns to the source vertex
unless its ’current’ path to the target vertex is known to be blocked). But
any departure from the disjoint-path structure (such as adding even one
more edge that crosses between vertices in two of the paths) complicates
things considerably by voiding the optimality of committing policies.
18

The st-reliability problem (finding the probability that an unblocked
path from s to t exists) appears to be an essential building block in solving
CTP. The reduction in [1] shows that CTP is intractable for almost any
graph topology for which st-reliability is intractable as well. An open research question is whether CTP is tractable or easy to approximate for graph
topologies in which st-reliability is tractable, such as “tree-structured” graphs,
or the more general series-parallel graphs.
Sensing-CTP is generally harder than CTP for restricted topologies,
as shown in Section 4. Other variants of CTP, such as CTP-Dep, are also
harder than CTP, as dependencies can act like remote sensing. It was shown
that CTP-Dep is NP-hard for disjoint path graphs [13]. However, when
considering topological restrictions, one must also consider the topology of
the dependency-graph, and the hardness proof in [13] used an essentially
unrestricted topology Bayes network to represent the dependencies.
6. Acknowledgments
This research is partially supported by the Israel Science Foundation
grant 305/09, the Lynn and William Frankel Center for Computer Sciences,
and by ERC Advanced Investigator Grant 226203.
